!function(){"use strict";var e={d:function(t,n){for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r:function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};function n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}e.r(t),e.d(t,{MediaDownload:function(){return g},isExternalImage:function(){return c}});var i=window.lodash,l=window.wp.element,o=window.wp.plugins,a=window.wp.compose,s=window.wp.data,u=window.wp.blob;const c=e=>e&&e.includes(nextgenNuxPatterns.nuxApiEndpoint);var d=new WeakMap;class g extends l.Component{constructor(...e){super(...e),d.set(this,{writable:!0,value:[]}),n(this,"detectImageBlocks",(e=>{const{getBlockAttributes:t}=this.props;return e.map((e=>{const n=t(e);switch(!0){case!(null==n||!n.url):return{[e]:(0,i.pick)(n,["id","url"])};case!(null==n||!n.images):return{[e]:(0,i.pick)(n,["ids","images"])};case!(null==n||!n.imageUrl):return{[e]:(0,i.pick)(n,["imageUrl"])};case!(null==n||!n.mediaUrl)&&"image"===(null==n?void 0:n.mediaType):return{[e]:(0,i.pick)(n,["mediaId","mediaUrl"])};case!(null==n||!n.backgroundImg):return{[e]:(0,i.pick)(n,["backgroundImg"])};default:return null}}))})),n(this,"onFileChange",((e,t,n,r)=>{const{getBlockAttributes:i,updateBlockAttributes:l}=this.props;switch(!0){case!(null==r||!r.imageUrl):l(n,{imageUrl:e.url});break;case!(null==r||!r.url):l(n,{id:e.id,url:e.url});break;case!(null==r||!r.mediaUrl):l(n,{mediaId:e.id,mediaUrl:e.url});break;case!(null==r||!r.backgroundImg):l(n,{backgroundImg:e.url});break;case!(null==r||!r.images):{const r=[...i(n).images];r[t]={...r[t],id:e.id,url:e.url},!(0,u.isBlobURL)(e.url)&&"link"in r[t]&&(r[t].link=e.url),l(n,{ids:r.map((e=>e.id||null)),images:r})}}})),n(this,"uploadExternalImages",((e,t)=>{var n,r;const{createWarningNotice:i,mediaUpload:l}=this.props;let o=this.getUrlsFromBlockAttributes(t);o=null===(n=o)||void 0===n?void 0:n.filter((e=>void 0!==e)),null!==(r=o)&&void 0!==r&&r.length&&o.forEach(((n,r)=>{window.fetch(n).then((e=>e.blob())).then((n=>{l({filesList:[n],allowedTypes:["image"],onFileChange:([n])=>this.onFileChange(n,r,e,t),onError:e=>i(e)})})).catch((e=>i(e)))}))}))}componentDidUpdate(){const e=(0,i.difference)(this.props.clientIds,function(e,t){return t.get?t.get.call(e):t.value}(this,r(this,d,"get")));this.detectImageBlocks(e).filter((e=>!!e)).forEach((e=>{const[t,n]=Object.entries(e)[0];this.uploadExternalImages(t,n)})),function(e,t,n){(function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}})(e,r(e,t,"set"),n)}(this,d,this.props.clientIds)}getUrlsFromBlockAttributes(e){switch(!0){case c(null==e?void 0:e.imageUrl):return[e.imageUrl];case c(null==e?void 0:e.url):return[e.url];case c(null==e?void 0:e.mediaUrl):return[e.mediaUrl];case c(null==e?void 0:e.backgroundImg):return[e.backgroundImg];case!(null==e||!e.images):return e.images.filter((e=>c(null==e?void 0:e.url))).map((e=>e.url))}}render(){return null}}(0,o.registerPlugin)("nextgen-media-download",{render:(0,a.compose)([(0,s.withSelect)((e=>{const{getBlockAttributes:t,getBlockName:n,getClientIdsWithDescendants:r,getSettings:i}=e("core/block-editor");return{mediaUpload:i().mediaUpload,clientIds:r(),getBlockAttributes:t,getBlockName:n}})),(0,s.withDispatch)((e=>{const{updateBlockAttributes:t}=e("core/block-editor");return{updateBlockAttributes:t}}))])(g)}),(window.nextgen=window.nextgen||{}).mediaDownload=t}();