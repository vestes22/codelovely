"use strict";!function(){var o,n,i,a,t,r;o=window.wp,n=jQuery,o&&o.customize&&((a=o.customize).PositionControl=a.Control.extend({ready:function(){var t=this;return _.bindAll(t,"startPositioning","cancelPositioning","stopPositioning","removePosition"),t.container.on("click keydown",".start-button",t.startPositioning),t.container.on("click keydown",".done-button",t.stopPositioning),t.container.on("click keydown",".cancel-button",t.cancelPositioning),t.container.on("click keydown",".remove-button",t.removePosition),t.state=new a.Value("default"),t.aspectRatio=new a.Value(null),t.setting.bind(function(e){return t.params.position=e?e.split(","):null,t.renderContent()}),t.state.bind(function(e){return t.params.state=e,t.renderContent()}),a.previewer.bind("voucher:update-position:"+t.params.voucher_field_id,function(e){return t.setting.set(e)}),a.previewer.bind("voucher:click-position:"+t.params.voucher_field_id,function(){return t.focus(),t.startPositioning()}),n(document).on("keydown",function(e){if(27===e.keyCode&&"positioning"===t.state.get()&&t.cancelPositioning(),13===e.keyCode&&"positioning"===t.state.get())return t.stopPositioning()}),a.bind("save",function(){return t.stopPositioning()})},startPositioning:function(){var e;return this.current_value=this.setting.get(),this.state.set("positioning"),e={field_id:this.params.voucher_field_id,aspect_ratio:this.aspectRatio.get()},a.previewer.send("voucher:start-positioning",e)},removePosition:function(){return this.setting.set(""),this.state.set("default"),a.previewer.send("voucher:remove-position",this.params.voucher_field_id)},cancelPositioning:function(){return this.current_value&&this.setting.set(this.current_value||""),this.stopPositioning()},stopPositioning:function(){return this.state.set("default"),a.previewer.send("voucher:stop-positioning",this.params.voucher_field_id)}}),a.BarcodePositionControl=a.PositionControl.extend({ready:function(){var t=this;return a.PositionControl.prototype.ready.call(t),t.aspectRatio.set(t.params.aspect_ratio[a.get().wc_voucher_template_barcode_barcode_type]),a.bind("change",function(e){if(-1!==e.id.indexOf("barcode_type"))return e=a.get().wc_voucher_template_barcode_barcode_type,t.aspectRatio.set(t.params.aspect_ratio[e]),"qr"!==e?a.notifications.add(new a.Notification("only_qr_scanning",{message:woocommerce_vouchers_admin_customizer.i18n.something,type:"warning",dismissible:!0})):a.notifications.remove("only_qr_scanning"),a.PositionControl.prototype.stopPositioning.call(t),a.PositionControl.prototype.startPositioning.call(t)})}}),a.VoucherImageControl=a.HeaderControl.extend({ready:function(){return this.btnNew=n("#customize-control-wc_pdf_product_vouchers_voucher_image .actions .new"),_.bindAll(this,"openMedia"),this.btnNew.on("click",this.openMedia),a.HeaderTool.currentHeader=this.getInitialVoucherImage(),new a.VoucherCurrentImageView({model:a.HeaderTool.currentHeader,el:"#customize-control-wc_pdf_product_vouchers_voucher_image .current .container"}),new a.HeaderTool.ChoiceListView({collection:a.HeaderTool.UploadsList=new a.VoucherImageChoiceList,el:"#customize-control-wc_pdf_product_vouchers_voucher_image .choices .uploaded .list"}),new a.HeaderTool.ChoiceListView({collection:a.HeaderTool.DefaultsList=new a.VoucherImageDefaultsList,el:"#customize-control-wc_pdf_product_vouchers_voucher_image .choices .default .list"}),a.HeaderTool.combinedList=a.HeaderTool.CombinedList=new a.HeaderTool.CombinedList([a.HeaderTool.UploadsList,a.HeaderTool.DefaultsList]),o.media.controller.Cropper.prototype.defaults.doCropArgs.wp_customize="on",o.media.controller.Cropper.prototype.defaults.doCropArgs.customize_theme=a.settings.theme.stylesheet},getInitialVoucherImage:function(){var e=a.get().wc_voucher_template_voucher_primary_image;return e&&_wpCustomizeHeader.uploads[e.id]?(e=_wpCustomizeHeader.uploads[e.id],new a.VoucherImageModel({header:e,choice:e.url.split("/").pop()})):new a.VoucherImageModel},openMedia:function(e){var t=_wpMediaViewsL10n;return e.preventDefault(),this.frame=new i({button:{text:t.select,close:!1},states:[new o.media.controller.Library({title:t.chooseImage,library:o.media.query({type:"image"}),defaults:o.media.query({type:"image",include:_wpCustomizeHeader._pdf_vouchers.default_images}),multiple:!1,date:!1,priority:20,suggestedWidth:_wpCustomizeHeader.data.width,suggestedHeight:_wpCustomizeHeader.data.height})]}),this.frame.on("select",this.onSelect,this),this.frame.open()},onSelect:function(){var e=this.frame.state().get("selection").first().toJSON();return this.setImageFromURL(e.url,e.id,e.width,e.height),this.frame.close()},setImageFromURL:function(e,t,o,i){var r={};return r.url=e,r.thumbnail_url=e,r.timestamp=_.now(),t&&(r.attachment_id=t),o&&(r.width=o),i&&(r.height=i),e=new a.VoucherImageModel({header:r,choice:e.split("/").pop()}),a.HeaderTool.UploadsList.add(e),a.HeaderTool.currentHeader.set(e.toJSON()),e.save(),e.importImage()}}),a.VoucherImageModel=a.HeaderTool.ImageModel.extend({destroy:function(){var e=this.get("header"),t=a.HeaderTool.currentHeader.get("header").attachment_id,o=_.clone(a("wc_voucher_template_voucher_images").get())||[],i=o.indexOf(e.attachment_id);return-1<i&&o.splice(i,1),a("wc_voucher_template_voucher_images").set(o),t&&e.attachment_id===t&&((t=this.collection.at(1))?(t.save(),a.HeaderTool.currentHeader.set(t.toJSON())):a.HeaderTool.currentHeader.trigger("hide")),this.trigger("destroy",this,this.collection)},save:function(){var e=this.get("header");return a("wc_voucher_template_voucher_primary_image").set({id:e.attachment_id,src:e.url,width:e.width,height:e.height}),a.HeaderTool.combinedList.trigger("control:setImage",this)},importImage:function(){var e,t=this.get("header");if(void 0!==t.attachment_id)return(e=_.clone(a("wc_voucher_template_voucher_images").get())||[]).push(t.attachment_id),a("wc_voucher_template_voucher_images").set(e)}}),a.VoucherImageChoiceList=a.HeaderTool.ChoiceList.extend({model:a.VoucherImageModel,addRandomChoice:function(){}}),a.VoucherImageDefaultsList=a.HeaderTool.DefaultsList.extend({model:a.VoucherImageModel,addRandomChoice:function(){}}),a.VoucherCurrentImageView=a.HeaderTool.CurrentView.extend({getHeight:function(){var e=this.$el.find("img");return e.length?(this.$el.find(".inner").hide(),e.height()||"auto"):(this.$el.find(".inner").show(),40)}}),a.bind("ready",function(){var i=a.previewer.query;return a.previewer.query=function(){var e=i.call(this),t=r(window.location.search.substr(1)).url,o=document.createElement("a");return o.href=t,e.voucher_template_id=r(o.search).p,e},a("wc_voucher_template_allow_online_redemptions",function(e){var t=function(){return a("wc_voucher_template_voucher_number_pos",function(e){if(!e.get())return e._dirty=!0})};return e.get()&&t(),e.bind(function(e){if(e)return t()})})}),n.extend(a.controlConstructor,{wc_pdf_product_vouchers_position:a.PositionControl,wc_pdf_product_vouchers_voucher_image:a.VoucherImageControl,wc_pdf_product_vouchers_barcode_position:a.BarcodePositionControl}),r=function(e){var e=e.split("&"),t={};return e.forEach(function(e){e=e.split("=",2);if(2===e.length)return t[e[0]]=decodeURIComponent(e[1].replace(/\+/g," "))}),t},t=function(){return n("#tiptip_holder").removeAttr("style"),n("#tiptip_arrow").removeAttr("style"),n(".font-style-button").tipTip({attribute:"data-tip",fadeIn:0,fadeOut:0,delay:0})},n(function(){var e,o;if(t(),n(".customize-info .customize-panel-description").html(woocommerce_vouchers_admin_customizer.i18n.customizer_description),a("wc_voucher_template_post_title",function(e){return e.get()||(e._dirty=!0),e.bind(function(e){e=e||woocommerce_vouchers_admin_customizer.i18n.untitled_template;return n(".customize-info .site-title").text(e)})}),n("#customize-control-wc_voucher_template_logo_image_id img.attachment-thumb").on("load",function(){var e=n(this).width()+":"+n(this).height();return a.control.value("wc_voucher_template_logo_pos").aspectRatio.set(e)}),a("wc_voucher_template_logo_image_id",function(e){var r=a.control.value("wc_voucher_template_logo_pos");return e.get()||(r.aspectRatio.set(""),r.state.set("")),e.bind(function(e){return e?(r.state.set("default"),n("#customize-control-wc_voucher_template_logo_image_id img.attachment-thumb").on("load",function(){var e=n(this).width(),t=n(this).height(),o=e+":"+t,i=r.setting.get();if(r.aspectRatio.set(o),i)return(o=r.setting.get().split(",").map(function(e){return parseInt(e,10)}))[3]=Math.round(t/e*o[2]),i=o.join(","),r.setting.set(i),a.previewer.send("voucher:update-position","wc_voucher_template_logo_pos")})):(r.aspectRatio.set(""),r.state.set(""),r.setting.set(""),a.previewer.send("voucher:remove-position","wc_voucher_template_logo_pos"))})}),n(".customize-control-wc_pdf_product_vouchers_font_style input").on("change",function(e){var t=n(e.target).closest(".font-style-button");return"radio"===e.target.type&&t.siblings().removeClass("active"),t[n(e.target).is(":checked")?"addClass":"removeClass"]("active")}).on("click",function(e){var t;if("radio"===e.target.type&&(t=n(e.target).closest(".font-style-button")).hasClass("active"))return n(e.target).removeAttr("checked"),t.removeClass("active").siblings(".font-style-text-align-empty").prop("checked",!0).change()}),e=n('input[type="range"]'))return e.each(function(){return n(this).closest("label").append('<span class="wc-pdf-product-vouchers-range-index"></span>')}),o=function(e){var t=n(e).val(),t=0<t?t+"px":woocommerce_vouchers_admin_customizer.i18n.default;return n(e).parent().find(".wc-pdf-product-vouchers-range-index").text(t)},e.on("input",function(){return o(this)}),e.each(function(e,t){return o(t)})}),i=o.media.view.MediaFrame.Select.extend({bindHandlers:function(){return o.media.view.MediaFrame.Select.prototype.bindHandlers.apply(this,arguments),this.on("content:render:defaults",this.defaultsContent,this)},browseRouter:function(e){return e.set({upload:{text:_wpMediaViewsL10n.uploadFilesTitle,priority:20},browse:{text:_wpMediaViewsL10n.mediaLibraryTitle,priority:40},defaults:{text:_wpCustomizeHeader._pdf_vouchers.i18n.default_images_title,priority:60}})},defaultsContent:function(e){var t=this.state();return this.content.set(new o.media.view.AttachmentsBrowser({controller:this,collection:t.get("defaults"),selection:t.get("selection"),model:t,sortable:!1,search:!1,filters:!1,date:t.get("date"),display:t.has("display")?t.get("display"):t.get("displaySettings"),dragInfo:t.get("dragInfo"),idealColumnWidth:t.get("idealColumnWidth"),suggestedWidth:t.get("suggestedWidth"),suggestedHeight:t.get("suggestedHeight"),AttachmentView:t.get("AttachmentView")}))}}))}.call(void 0);
//# sourceMappingURL=wc-pdf-product-vouchers-customizer-controls.min.js.map
