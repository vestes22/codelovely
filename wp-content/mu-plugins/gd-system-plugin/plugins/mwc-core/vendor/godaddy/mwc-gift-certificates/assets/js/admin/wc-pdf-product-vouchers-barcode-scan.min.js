"use strict";!function(){jQuery(function(r){var o,n,i,t,a,d,c,s,e,u,v;return window.pdf_vouchers_barcode_scanning_unsupported_browser=!1,d=null!=(e=window.wc_pdf_product_vouchers_admin)?e:{},v=document.createElement("video"),i=document.getElementById("canvas"),n=i.getContext("2d"),o=r("#barcode-value"),s=r("#redeem-voucher-form"),a=function(e,t,r){return n.beginPath(),n.moveTo(e.x,e.y),n.lineTo(t.x,t.y),n.lineWidth=4,n.strokeStyle=r,n.stroke()},u=function(){var e,t;return v.readyState===v.HAVE_ENOUGH_DATA&&0<v.videoHeight&&0<v.videoWidth&&(i.hidden=!1,i.height=v.videoHeight,i.width=v.videoWidth,n.drawImage(v,0,0,i.width,i.height),t=n.getImageData(0,0,i.width,i.height),e=jsQR(t.data,t.width,t.height,{inversionAttempts:"dontInvert"})),e&&(a(e.location.topLeftCorner,e.location.topRightCorner,t="#FF3B58"),a(e.location.topRightCorner,e.location.bottomRightCorner,t),a(e.location.bottomRightCorner,e.location.bottomLeftCorner,t),a(e.location.bottomLeftCorner,e.location.topLeftCorner,t),v.srcObject.getTracks().forEach(function(e){return e.stop()}),v.srcObject=null,o.val(e.data),setTimeout(function(){return i.hidden=!0,s.submit()},Math.floor(500*Math.random()+200))),setTimeout(function(){return requestAnimationFrame(u)},40)},c=function(){if(void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia)return navigator.webkitGetUserMedia||navigator.mozGetUserMedia||(window.pdf_vouchers_barcode_scanning_unsupported_browser=!0),navigator.mediaDevices.getUserMedia=function(r){var o=navigator.webkitGetUserMedia||navigator.mozGetUserMedia;return o?new Promise(function(e,t){return o.call(navigator,r,e,t)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}},t=function(e){var t=r(".js-redeem-message");return t.html("<p>"+e+"</p>").removeClass("notice-success notice-waring").addClass("notice-error"),t.removeClass("hidden")},r(document).ready(function(){return"https:"!==window.location.protocol?(t(d.i18n.barcode_requires_https_error),void r("#scan-qr").attr("disabled","disabled")):r("#scan-qr").on("click",function(e){return e.preventDefault(),"undefined"==typeof Promise&&(window.pdf_vouchers_barcode_scanning_unsupported_browser=!0),c(),window.pdf_vouchers_barcode_scanning_unsupported_browser?t(d.i18n.barcode_unsupported_browser_error):navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}}).then(function(e){return v.srcObject=e,v.setAttribute("playsinline",!0),v.play(),requestAnimationFrame(u)}).catch(function(e){return t(d.i18n.barcode_scanner_generic_error),console.log("PDF Vouchers barcode scanner error: "+e.message)})})})})}.call(void 0);
//# sourceMappingURL=wc-pdf-product-vouchers-barcode-scan.min.js.map
